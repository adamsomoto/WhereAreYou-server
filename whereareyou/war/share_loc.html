<html>

<head>
    <title>Where RU</title>
    <script type = "text/javascript"
            src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>



<body onload="getLocation()">




<p id="demo"></p>

<div id="map"></div>

<script>

    var x = document.getElementById("demo");

    function getParameterByName(name, url) {
        if (!url) {
            url = window.location.href;
        }
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function getParameterByName(name, url) {
        if (!url) {
            url = window.location.href;
        }
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        //return decodeURIComponent(results[2].replace(/\+/g, " "));
        return results[2];
    }

    function distance(location1, location2) {
        var radius = 6371; // Earth's radius in kilometers
        var latDelta = deg2rad(location2[0] - location1[0]);
        var lonDelta = deg2rad(location2[1] - location1[1]);

        var a = (Math.sin(latDelta / 2) * Math.sin(latDelta / 2)) +
            (Math.cos(deg2rad(location1[0])) * Math.cos(deg2rad(location2[0])) *
            Math.sin(lonDelta / 2) * Math.sin(lonDelta / 2));

        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

        return radius * c;
    };

    function deg2rad(deg) {
        return deg * (Math.PI/180)
    }

    var lon1 = 32.1091786;
    var lat1 = 34.8448102;
    var lon2 = 32.1191786;
    var lat2 = 34.1191786;

    function showPosition(position) {
        var time = new Date();

        var umid = getParameterByName('umid'); // "lorem"
        var android_id = getParameterByName('androidid'); // android_id


        $.post('/Users', {latitude: position.coords.latitude,longitude:position.coords.longitude,umid:umid });


        var data = $.get('/Users/?umid='+android_id, function( data ){
            return data;
        });

        var lon1 = position.coords.latitude;
        var lat1 = position.coords.longitude;
        var lon2 = data.longitude;
        var lat2 = data.latitude;

        var location1 = [position.coords.latitude, position.coords.longitude] ;
        var location2 = [lat2,lon2];

        var hour = time.getHours();
        var minutes = "0" + time.getMinutes();
        var seconds = "0" + time.getSeconds();
        var formatted =  hour + ':' + minutes.substr(-2) + ':' + seconds.substr(-2) ;

        var dist = distance(location1,location2);
        x.innerHTML = "You're sending your location"+
            "<br>Latitude: " + position.coords.latitude +
            "<br>Longitude: " + position.coords.longitude +
            "<br>Last update: " + formatted +
            "<br>Distance: "+dist.toFixed(2)+' km';
        x.style.position = "absolute";
        x.style.bottom = "0px";
        x.style.textAlign = "center";
        x.style.width = "100%";


    }





    setInterval(getLocation,20*1000)

</script>



</body>
</head>



</html>